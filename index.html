<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <title>üéâ FestQuiz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- STARTSK√ÑRM -->
    <div id="startScreen">
        <h1>üéâ FestQuiz</h1>

        <h2>V√§lj kategori</h2>
        <div id="categories">
            <button data-category="">Alla</button>
            <button data-category="modern">üÜï 2025 & Nutid</button>
            <button data-category="9">Allm√§nbildning</button>
            <button data-category="11">Film</button>
            <button data-category="12">Musik</button>
            <button data-category="21">Sport</button>
            <button data-category="15">TV-Spel</button>
            <button data-category="23">Historia</button>
            <button data-category="17">Vetenskap</button>
            <button data-category="22">Geografi</button>
            <button id="randomCategory">üé≤ Slumpa kategori</button>
        </div>

        <h2>Antal fr√•gor</h2>
        <select id="questionCount">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="15">15</option>
            <option value="20">20</option>
        </select>

        <h2>Sv√•righetsgrad</h2>
        <select id="difficulty">
            <option value="">Blandad</option>
            <option value="easy">L√§tt</option>
            <option value="medium">Medel</option>
            <option value="hard">Sv√•r</option>
        </select>

        <button id="startBtn">Starta quiz</button>
        <button id="musicBtn">‚ñ∂Ô∏è Starta musik</button>

    </div>

    <!-- QUIZ -->
    <div id="quizScreen" class="hidden">
        <p id="progress"></p>
        <h2 id="questionText"></h2>
        <div id="answers"></div>
        <button id="nextBtn" class="hidden">N√§sta fr√•ga ‚û°Ô∏è</button>
        <p id="timer">Tid kvar: 30</p>
    </div>

    <script src="app.js"></script>

    <script>
        (function () {
            // Kr√§ver att room-kod finns i URL: ?room=AB12
            const params = new URLSearchParams(window.location.search);
            const roomCode = params.get("room");
            if (!roomCode) return;

            // Hook: anropa denna n√§r V1 byter till ny fr√•ga
            window.sendQuestionToV2 = async function (questionObject) {
                try {
                    await fetch(`/room/question?room=${roomCode}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(questionObject)
                    });
                } catch (e) {
                    console.error("Kunde inte skicka fr√•ga till V2", e);
                }
            };
        })();
    </script>

    <script>
        /* ================================
           V2 TIMER ‚Üí VISUELL NEDR√ÑKNING (V1)
           ================================ */

        let v2TimerInterval = null;

        function startV2Countdown(roomCode) {
            if (v2TimerInterval) clearInterval(v2TimerInterval);

            v2TimerInterval = setInterval(async () => {
                try {
                    const res = await fetch(`/room/${roomCode}`);
                    if (!res.ok) return;

                    const data = await res.json();
                    if (!data.timer || !data.timer.ends_at) return;

                    const now = Date.now() / 1000;
                    const remaining = Math.max(0, Math.ceil(data.timer.ends_at - now));

                    // ‚¨áÔ∏è H√ÑR uppdaterar du din befintliga timer-text i V1
                    const timerEl = document.getElementById("timer");
                    if (timerEl) {
                        timerEl.textContent = remaining;
                    }

                } catch (e) {
                    // tyst ‚Äì ingen logg p√• TV
                }
            }, 500);
        }
    </script>

    <script>
        // STARTA V2-TIMER VISUELLT N√ÑR TV-VYN LADDAS
        document.addEventListener("DOMContentLoaded", () => {
            startV2Countdown(window.ROOM_CODE);
        });
    </script>

</body>

</html>