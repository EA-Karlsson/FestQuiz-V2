<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8" />
    <title>FestQuiz TV</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- TV klarar reload -->
    <meta http-equiv="refresh" content="5">

    <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
</head>

<body>
    <script>
        const params = new URLSearchParams(location.search);
        const room = params.get("room");

        class HostScene extends Phaser.Scene {
            constructor() { super("host"); }
            create() {
                this.add.text(960, 540, "HOST QR", { fontSize: "48px" }).setOrigin(0.5);
            }
        }

        class JoinScene extends Phaser.Scene {
            constructor() { super("join"); }
            create() {
                this.add.text(960, 540, "PLAYER QR", { fontSize: "48px" }).setOrigin(0.5);
            }
        }

        class GameScene extends Phaser.Scene {
            constructor() { super("game"); }
            create() {
                this.add.text(960, 540, "QUIZET KÃ–R", { fontSize: "48px" }).setOrigin(0.5);
            }
        }

        class ScoreboardScene extends Phaser.Scene {
            constructor() { super("scoreboard"); }
            create() {
                this.add.text(960, 540, "RESULTAT", { fontSize: "48px" }).setOrigin(0.5);
            }
        }

        const game = new Phaser.Game({
            type: Phaser.AUTO,
            width: 1920,
            height: 1080,
            backgroundColor: "#0d0d0d",
            scene: [HostScene, JoinScene, GameScene, ScoreboardScene]
        });

        // ðŸ”‘ EN FETCH VID START
        (async () => {
            if (!room) return game.scene.start("host");

            const res = await fetch(`/room/${room}`);
            if (!res.ok) return game.scene.start("host");

            const d = await res.json();

            if (!d.host_ready) return game.scene.start("host");
            if (!d.started) return game.scene.start("join");
            if (d.phase === "scoreboard") return game.scene.start("scoreboard");

            return game.scene.start("game");
        })();
    </script>
</body>

</html>